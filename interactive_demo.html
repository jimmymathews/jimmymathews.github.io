<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><style>
    body {
        font-family: sans-serif;
        font-size: 1.2em;
    }
    div.figdiv {
        text-align: center;
    }
    div.tableheatbounder {
        background-color: #eeeeee;
        display: inline-block;
        padding: 15px;
    }
    p.tabletitle {
        text-align: center;
    }
    p {
        text-align: center;
    }
    table.heat {
        border-spacing: 3px;
        padding: 10px;
        display: inline;
    }
    table.heat tr th {
        padding: 5px;
    }
    table.heat tr td {
        padding: 25px 10px 10px 25px;
        text-align: center;
    }

    table.heat tr td.zero {
        /* background: #F0FFFF; */
        background: #e9e3f8;
    }
    table.heat tr td.zero:hover {
        background: #cdbbf4;
    }

    table.heat tr td.one {
        /* background: #F08080; */
        background: #f25b24;
    }
    table.heat tr td.one:hover {
        background: #f6a476;
    }

    table.heat tr td.highlight {
        background: lightgray;
    }

    div.tablestatsbounder {
        background-color: #eeeeee;
        display: inline-block;
        padding: 15px;
    }

    table.stats {
        display: inline;
    }

    table.stats tr td.pvals {
        width: 20ch;
    }

    table.stats tr td {
        text-align: left;
        padding: 15px;
    }

    .numintersections {
        font-weight: bold;
    }

    .numintersections:hover {
        text-decoration: underline dotted;
        cursor: default;
    }

    #captiontext {
        padding: 0 30% 0 30%;
        text-align: left;
    }

    .pmetercontainer {
        border: 1px solid gray;
        width: 180px;
        height: 15px;
        display: inline-block;
    }

    #pmeter_p {
        background: #a6ff97;
        position: absolute;
        width: 0px;
        height: 15px;
        display: inline-block;
    }

    #pmeter_singlep {
        background: #a6ff97;
        position: absolute;
        width: 0px;
        height: 15px;
        display: inline-block;
    }

    a {
        text-decoration: none;
    }
    a:hover {
        text-decoration: underline;
    }
    </style><script>function falling_factorial(first, last) {
    let big_first = BigInt(first)
    let big_last = BigInt(last)
    let accumulator = BigInt(1)
    for (let k = last; k <= first; k++) {
        accumulator = accumulator * BigInt(k)
    }
    return accumulator
}

function factorial(number) {
    return falling_factorial(number, 1)
}

function binom(ambient_size, subset_size) {
    smaller = Math.min(subset_size, ambient_size - subset_size)
    larger = Math.max(subset_size, ambient_size - subset_size)
    return falling_factorial(ambient_size, larger + 1) / factorial(smaller)
}

function sign(x) {
    if (x % 2 == 0) {
        return 1
    } else {
        return -1
    }
}

function compute_number_of_covers(set_sizes, ambient_size) {
    let N = ambient_size
    let n = set_sizes
    accumulator = BigInt(0)
    for (let m = Math.max(...n); m < N+1; m++) {
        product = BigInt(1)
        for (let i = 0; i < n.length; i++) {
            product *= binom(m, n[i])
        }
        accumulator += BigInt(sign(N+m)) * binom(N,m) * product
    }
    return accumulator
}

function count_all_configurations(set_sizes, ambient_size) {
    product = BigInt(1)
    for (let i = 0; i < set_sizes.length; i++) {
        product *= binom(ambient_size, set_sizes[i])
    }
    return product
}

function calculate_probability_of_multicoincidence(ambient_size, set_sizes, intersection_size) {
    reduced_sizes = []
    for (let i = 0; i < set_sizes.length; i++) {
        reduced_sizes.push(set_sizes[i] - intersection_size)
    }

    initial_choices = binom(ambient_size, intersection_size)
    reduced_ambient_size = ambient_size - intersection_size
    complementary_sizes = []
    for (let i = 0; i < reduced_sizes.length; i++) {
        complementary_sizes.push(reduced_ambient_size - reduced_sizes[i])
    }
    covers_of_remaining = compute_number_of_covers(complementary_sizes, reduced_ambient_size)
    all_configurations = count_all_configurations(set_sizes, ambient_size)
    precision = 10000000000000000
    return (Number(initial_choices * covers_of_remaining * BigInt(precision) / all_configurations) / precision)
}

function coincidencetest(incidence_statistic, frequencies, number_samples, correction_feature_set_size) {
    accumulator = 0
    for (let I = incidence_statistic; I <= Math.min(...frequencies); I++) {
        accumulator += calculate_probability_of_multicoincidence(number_samples, frequencies, I)
        if (accumulator > 0.9) {
            accumulator = 1.0
            break
        }
    }
    if ( !(correction_feature_set_size == null) ) {
        accumulator = accumulator * parseInt(binom(correction_feature_set_size, frequencies.length))
        if (accumulator > 1.0) {
            accumulator = 1.0
        }
    }
    return accumulator
}
</script><script>
data_obj = {
    data : [
        [1,1,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,1,1,1],
        [0,0,1,0,1,1,0,0,1,1,0,1,1,0,0,1,0,1,1,1],
        [0,0,1,1,0,0,0,0,0,1,0,1,0,1,0,1,1,1,1,1],
        [0,1,0,0,0,0,0,1,0,0,1,1,0,0,1,1,0,1,1,1],
    ]
}

function retrieve_data() {
    for (let j = 0; j < data_obj.data.length; j++) {
        for (let i =0; i < data_obj.data[0].length; i++) {
            let element = document.getElementById(i + ';' + j)
            if (element.classList.contains('one')) {
                data_obj.data[j][i] = 1
            } else {
                data_obj.data[j][i] = 0
            }
        }
    }
    return data_obj.data
}

function sum(row) {
    let accumulator = 0
    for (let k = 0; k < row.length ; k++) {
        accumulator += row[k]
    }
    return accumulator
}

function get_frequency(j) {
    return sum(data_obj.data[j])
}

function get_frequencies(data) {
    let frequencies = []
    for (let k = 0; k < data.length ; k++) {
        frequencies.push(sum(data[k]))
    }
    return frequencies
}

function get_intersections(data) {
    let included = 0
    for (let i = 0; i < data[0].length; i++) {
        let number_in = 0
        for (let j = 0; j < data.length; j++) {
            if (data[j][i] == 1) {
                number_in += 1
            }
        }
        if (number_in == data_obj.data.length) {
            included += 1
        }
    }
    return included
}

function fill_fields(data) {
    let frequencies = get_frequencies(data)
    let number_intersections = get_intersections(data)

    document.getElementById("numfeatures").innerText = data.length + ""
    document.getElementById("frequencies").innerText = frequencies.join(', ')

    let inter = document.getElementsByClassName("numintersections")
    for (let k = 0; k < inter.length; k++) {
        inter[k].innerText = "" + number_intersections
    }

    for (let j = 0; j < data.length; j++) {
        document.getElementById("F" + j).innerText = get_frequency(j)
    }

    let ambient_size = data[0].length
    let intersection_size = number_intersections
    let set_sizes = frequencies
    let singlep = calculate_probability_of_multicoincidence(ambient_size, set_sizes, intersection_size)
    let pvalue = coincidencetest(intersection_size, set_sizes, ambient_size, null)

    document.getElementById("singlep").innerText = singlep
    document.getElementById("pvalue").innerText = pvalue

    draw_p_meters()

    // update_download_link()
}

function handle_click(element) {
    element.classList.toggle('zero');
    element.classList.toggle('one');
    fill_fields(retrieve_data())
}

function change_highlight_intersections(flag) {
    let data = data_obj.data
    for (let i = 0; i < data[0].length; i++) {
        let number_in = 0
        for (let j = 0; j < data.length; j++) {
            if (data[j][i] == 1) {
                number_in += 1
            }
        }
        if (number_in == data_obj.data.length) {
            for (let j = 0; j < data.length; j++) {
                let element = document.getElementById(i + ';' + j)
                if (flag) {
                    element.classList.add('highlight')
                } else {                    
                    element.classList.remove('highlight')
                }
            }
        }
    }
}

function highlight_intersections() {
    change_highlight_intersections(true)
}

function unhighlight_intersections() {
    change_highlight_intersections(false)    
}

function draw_p_meter(element_name, value) {
    var c = document.getElementById(element_name);
    c.style.width = parseInt(180 * value) + 'px'
}

function draw_p_meters() {
    singlep = parseFloat(document.getElementById("singlep").innerText)
    pvalue = parseFloat(document.getElementById("pvalue").innerText)
    draw_p_meter("pmeter_singlep", singlep)
    draw_p_meter("pmeter_p", pvalue)
}

function update_download_link() {
    var s = new XMLSerializer()
    document.getElementById('download_this_page').style.visibility = 'hidden'
    document.getElementById('captiontext').style.visibility = 'hidden'
    download_link = document.getElementById('download_this_page')
    download_link.href = ""
    var str = s.serializeToString(document)
    document.getElementById('download_this_page').style.visibility = 'visible'
    document.getElementById('captiontext').style.visibility = 'visible'
    base64str = btoa(str)
    download_link.href = 'data: text/html;base64,' + base64str
    console.log(base64str)
    console.log('Updated download href.')
}
</script></head><body onload="fill_fields(retrieve_data())"><div class="figdiv"><div class="tableheatbounder"><table class="heat"><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th>frequency</th><tr><td id="0;0" onclick="handle_click(this)" class="one"></td><td id="1;0" onclick="handle_click(this)" class="one"></td><td id="2;0" onclick="handle_click(this)" class="one"></td><td id="3;0" onclick="handle_click(this)" class="zero"></td><td id="4;0" onclick="handle_click(this)" class="zero"></td><td id="5;0" onclick="handle_click(this)" class="zero"></td><td id="6;0" onclick="handle_click(this)" class="zero"></td><td id="7;0" onclick="handle_click(this)" class="one"></td><td id="8;0" onclick="handle_click(this)" class="zero"></td><td id="9;0" onclick="handle_click(this)" class="zero"></td><td id="10;0" onclick="handle_click(this)" class="one"></td><td id="11;0" onclick="handle_click(this)" class="zero"></td><td id="12;0" onclick="handle_click(this)" class="zero"></td><td id="13;0" onclick="handle_click(this)" class="one"></td><td id="14;0" onclick="handle_click(this)" class="zero"></td><td id="15;0" onclick="handle_click(this)" class="zero"></td><td id="16;0" onclick="handle_click(this)" class="one"></td><td id="17;0" onclick="handle_click(this)" class="one"></td><td id="18;0" onclick="handle_click(this)" class="one"></td><td id="19;0" onclick="handle_click(this)" class="one"></td><td><span id="F0">10</span></td></tr><tr><td id="0;1" onclick="handle_click(this)" class="zero"></td><td id="1;1" onclick="handle_click(this)" class="zero"></td><td id="2;1" onclick="handle_click(this)" class="one"></td><td id="3;1" onclick="handle_click(this)" class="zero"></td><td id="4;1" onclick="handle_click(this)" class="one"></td><td id="5;1" onclick="handle_click(this)" class="one"></td><td id="6;1" onclick="handle_click(this)" class="zero"></td><td id="7;1" onclick="handle_click(this)" class="zero"></td><td id="8;1" onclick="handle_click(this)" class="one"></td><td id="9;1" onclick="handle_click(this)" class="one"></td><td id="10;1" onclick="handle_click(this)" class="zero"></td><td id="11;1" onclick="handle_click(this)" class="one"></td><td id="12;1" onclick="handle_click(this)" class="one"></td><td id="13;1" onclick="handle_click(this)" class="zero"></td><td id="14;1" onclick="handle_click(this)" class="zero"></td><td id="15;1" onclick="handle_click(this)" class="one"></td><td id="16;1" onclick="handle_click(this)" class="zero"></td><td id="17;1" onclick="handle_click(this)" class="one"></td><td id="18;1" onclick="handle_click(this)" class="one"></td><td id="19;1" onclick="handle_click(this)" class="one"></td><td><span id="F1">11</span></td></tr><tr><td id="0;2" onclick="handle_click(this)" class="zero"></td><td id="1;2" onclick="handle_click(this)" class="zero"></td><td id="2;2" onclick="handle_click(this)" class="one"></td><td id="3;2" onclick="handle_click(this)" class="one"></td><td id="4;2" onclick="handle_click(this)" class="zero"></td><td id="5;2" onclick="handle_click(this)" class="zero"></td><td id="6;2" onclick="handle_click(this)" class="zero"></td><td id="7;2" onclick="handle_click(this)" class="zero"></td><td id="8;2" onclick="handle_click(this)" class="zero"></td><td id="9;2" onclick="handle_click(this)" class="one"></td><td id="10;2" onclick="handle_click(this)" class="zero"></td><td id="11;2" onclick="handle_click(this)" class="one"></td><td id="12;2" onclick="handle_click(this)" class="zero"></td><td id="13;2" onclick="handle_click(this)" class="one"></td><td id="14;2" onclick="handle_click(this)" class="zero"></td><td id="15;2" onclick="handle_click(this)" class="one"></td><td id="16;2" onclick="handle_click(this)" class="one"></td><td id="17;2" onclick="handle_click(this)" class="one"></td><td id="18;2" onclick="handle_click(this)" class="one"></td><td id="19;2" onclick="handle_click(this)" class="one"></td><td><span id="F2">10</span></td></tr><tr><td id="0;3" onclick="handle_click(this)" class="zero"></td><td id="1;3" onclick="handle_click(this)" class="one"></td><td id="2;3" onclick="handle_click(this)" class="zero"></td><td id="3;3" onclick="handle_click(this)" class="zero"></td><td id="4;3" onclick="handle_click(this)" class="zero"></td><td id="5;3" onclick="handle_click(this)" class="zero"></td><td id="6;3" onclick="handle_click(this)" class="zero"></td><td id="7;3" onclick="handle_click(this)" class="one"></td><td id="8;3" onclick="handle_click(this)" class="zero"></td><td id="9;3" onclick="handle_click(this)" class="zero"></td><td id="10;3" onclick="handle_click(this)" class="one"></td><td id="11;3" onclick="handle_click(this)" class="one"></td><td id="12;3" onclick="handle_click(this)" class="zero"></td><td id="13;3" onclick="handle_click(this)" class="zero"></td><td id="14;3" onclick="handle_click(this)" class="one"></td><td id="15;3" onclick="handle_click(this)" class="one"></td><td id="16;3" onclick="handle_click(this)" class="zero"></td><td id="17;3" onclick="handle_click(this)" class="one"></td><td id="18;3" onclick="handle_click(this)" class="one"></td><td id="19;3" onclick="handle_click(this)" class="one"></td><td><span id="F3">9</span></td></tr></table></div><br><br><div class="tablestatsbounder"><table class="stats"><tr><td>Probability of exactly <span onmouseenter="highlight_intersections()" onmouseleave="unhighlight_intersections()" class="numintersections">3</span> coincidents</td><td class="pmeter"><span class="pmetercontainer"><span id="pmeter_singlep"></span></span></td><td class="pvals"><span id="singlep">0.0795664</span></td></tr><td>Probability of <span class="numintersections" onmouseenter="highlight_intersections()" onmouseleave="unhighlight_intersections()">3</span> or more coincidents</td><td class="pmeter"><span class="pmetercontainer"><span id="pmeter_p"></span></span></td><td class="pvals"><span id="pvalue">0.09201</span></td><tr></tr></table></div><p class="tabletitle"><span id="numfeatures">4</span> features coinciding along <span class="numintersections" onmouseenter="highlight_intersections()" onmouseleave="unhighlight_intersections()">3</span> samples</p><p id="captiontext"><br>The probabilities are defined with respect to all configurations of 4 binary features with the given frequencies (<span id="frequencies">10, 11, 10, 9</span>).<br></p></div><p class="downloadpagecontainer"><a id="download_this_page" onmouseenter="update_download_link()" href="" title="figure.html" download="figure.html"><br>Download HTML</a></p></body></html>